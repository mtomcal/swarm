{"id":"swarm-0wx","title":"Command: attach - Attach to tmux window","description":"## Overview\nImplement the `swarm attach` command to attach to a worker's tmux window.\n\n## Dependencies\n- Depends on: swarm-1j8 (state), swarm-ljn (helpers)\n\n## Usage\n```bash\nswarm attach \u003cname\u003e\n```\n\n## Behavior\n```bash\ntmux select-window -t {session}:{name}\ntmux attach-session -t {session}\n```\n\n## Acceptance Criteria\n- [ ] Selects the correct window\n- [ ] Attaches to the session\n- [ ] Error for non-tmux workers\n- [ ] Error for non-existent workers","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T20:09:18.864649029Z","created_by":"mtomcal","updated_at":"2026-01-10T20:09:18.864649029Z","dependencies":[{"issue_id":"swarm-0wx","depends_on_id":"swarm-1j8","type":"blocks","created_at":"2026-01-10T20:11:24.169943446Z","created_by":"mtomcal"},{"issue_id":"swarm-0wx","depends_on_id":"swarm-ljn","type":"blocks","created_at":"2026-01-10T20:11:24.202155865Z","created_by":"mtomcal"}]}
{"id":"swarm-1j8","title":"Core: State file management and CLI skeleton","description":"## Overview\nImplement the foundational infrastructure for swarm.\n\n## Requirements\n- Single Python file: `swarm.py` (zero dependencies beyond stdlib)\n- State file location: `~/.swarm/state.json`\n- Log directory: `~/.swarm/logs/`\n- CLI skeleton using argparse with subparsers for all commands\n\n## State File Structure\n```json\n{\n  \"workers\": [\n    {\n      \"name\": \"w1\",\n      \"status\": \"running\",\n      \"cmd\": [\"claude\"],\n      \"started\": \"2024-01-10T14:30:00Z\",\n      \"cwd\": \"/path/to/dir\",\n      \"env\": {\"FOO\": \"bar\"},\n      \"tags\": [\"pr-review\"],\n      \"tmux\": {\"session\": \"swarm\", \"window\": \"w1\"},\n      \"worktree\": {\"path\": \"/path\", \"branch\": \"work/bd-001\", \"base_repo\": \"/path\"},\n      \"pid\": null\n    }\n  ]\n}\n```\n\n## Implementation\n1. Create State class with load/save methods\n2. Create ensure_dirs() for ~/.swarm and ~/.swarm/logs\n3. Create main() with argparse skeleton (all subparsers, arguments per PLAN.md)\n4. Add shebang and make executable\n\n## Acceptance Criteria\n- [ ] `python swarm.py --help` shows all commands\n- [ ] `python swarm.py spawn --help` shows spawn options\n- [ ] State file created on first access\n- [ ] Directories created automatically","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-10T20:07:26.39736652Z","created_by":"mtomcal","updated_at":"2026-01-10T20:13:49.95021041Z","closed_at":"2026-01-10T20:13:49.95021041Z","close_reason":"Closed"}
{"id":"swarm-4al","title":"Command: respawn - Respawn dead workers","description":"## Overview\nImplement the `swarm respawn` command to respawn a dead worker with its original command.\n\n## Dependencies\n- Depends on: swarm-szj (spawn command)\n\n## Usage\n```bash\nswarm respawn \u003cname\u003e [options]\n```\n\n## Options\n- `--clean-first` — Run clean before respawn (removes old worktree)\n\n## Behavior\n1. Read original spawn config from state\n2. If `--clean-first`, clean up old worktree\n3. Kill if still somehow running\n4. Spawn with same options\n\n## Acceptance Criteria\n- [ ] Reads original command from state\n- [ ] Respawns with same options (tmux, worktree, env, etc.)\n- [ ] --clean-first removes old worktree before respawn\n- [ ] Kills worker if still running\n- [ ] Error if worker not found","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T20:09:45.054460867Z","created_by":"mtomcal","updated_at":"2026-01-10T20:09:45.054460867Z","dependencies":[{"issue_id":"swarm-4al","depends_on_id":"swarm-szj","type":"blocks","created_at":"2026-01-10T20:11:27.992956745Z","created_by":"mtomcal"}]}
{"id":"swarm-4x2","title":"Command: interrupt and eof - Send control signals","description":"## Overview\nImplement the `swarm interrupt` and `swarm eof` commands.\n\n## Dependencies\n- Depends on: swarm-1j8 (state), swarm-ljn (helpers)\n\n## swarm interrupt\nSend Ctrl-C to a worker.\n\n```bash\nswarm interrupt \u003cname\u003e\nswarm interrupt --all\n```\n\nBehavior:\n```bash\ntmux send-keys -t {session}:{name} C-c\n```\n\n## swarm eof\nSend Ctrl-D (EOF) to a worker. This typically exits interactive programs like claude.\n\n```bash\nswarm eof \u003cname\u003e\n```\n\nBehavior:\n```bash\ntmux send-keys -t {session}:{name} C-d\n```\n\n## Acceptance Criteria\n- [ ] interrupt sends C-c to tmux window\n- [ ] interrupt --all sends to all running workers\n- [ ] eof sends C-d to tmux window\n- [ ] Both error for non-tmux workers\n- [ ] Both error for non-running workers","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T20:09:12.741813969Z","created_by":"mtomcal","updated_at":"2026-01-10T20:09:12.741813969Z","dependencies":[{"issue_id":"swarm-4x2","depends_on_id":"swarm-1j8","type":"blocks","created_at":"2026-01-10T20:11:24.104911328Z","created_by":"mtomcal"},{"issue_id":"swarm-4x2","depends_on_id":"swarm-ljn","type":"blocks","created_at":"2026-01-10T20:11:24.138680257Z","created_by":"mtomcal"}]}
{"id":"swarm-8jt","title":"Command: kill - Kill worker processes","description":"## Overview\nImplement the `swarm kill` command to kill worker processes.\n\n## Dependencies\n- Depends on: swarm-1j8 (state), swarm-ljn (helpers)\n\n## Usage\n```bash\nswarm kill \u003cname\u003e [options]\nswarm kill --all [options]\n```\n\n## Options\n- `--rm-worktree` — Also remove the git worktree\n- `--all` — Kill all workers\n\n## Behavior\n1. If tmux: `tmux kill-window -t {session}:{name}`\n2. If not tmux: `kill {pid}` (SIGTERM, then SIGKILL after 5s)\n3. Update state to `stopped`\n4. If `--rm-worktree` and worker has worktree:\n   - `git worktree remove {worktree_path} --force`\n\n## Acceptance Criteria\n- [ ] Kills tmux window for tmux workers\n- [ ] Sends SIGTERM then SIGKILL for non-tmux workers\n- [ ] Updates state to stopped\n- [ ] --rm-worktree removes worktree\n- [ ] --all kills all workers\n- [ ] Error if worker not found","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T20:08:31.352282168Z","created_by":"mtomcal","updated_at":"2026-01-10T20:08:31.352282168Z","dependencies":[{"issue_id":"swarm-8jt","depends_on_id":"swarm-1j8","type":"blocks","created_at":"2026-01-10T20:11:23.847383579Z","created_by":"mtomcal"},{"issue_id":"swarm-8jt","depends_on_id":"swarm-ljn","type":"blocks","created_at":"2026-01-10T20:11:23.87899654Z","created_by":"mtomcal"}]}
{"id":"swarm-an5","title":"Command: logs - View worker output","description":"## Overview\nImplement the `swarm logs` command to capture output from workers.\n\n## Dependencies\n- Depends on: swarm-1j8 (state), swarm-ljn (helpers)\n\n## Usage\n```bash\nswarm logs \u003cname\u003e [options]\n```\n\n## Options\n- `--history` — Include scrollback buffer (default: visible pane only)\n- `--lines \u003cn\u003e` — Number of scrollback lines (default: 1000)\n- `--follow` — Continuously poll and display (like tail -f)\n\n## Behavior (tmux workers)\n```bash\n# Default\ntmux capture-pane -t {session}:{name} -p\n\n# With history\ntmux capture-pane -t {session}:{name} -p -S -{lines}\n\n# Follow (poll every 1s)\nwatch -n1 \"tmux capture-pane -t {session}:{name} -p | tail -30\"\n```\n\n## Behavior (non-tmux workers)\n```bash\ncat ~/.swarm/logs/{name}.stdout\n# or\ntail -f ~/.swarm/logs/{name}.stdout\n```\n\n## Acceptance Criteria\n- [ ] Shows visible pane by default (tmux)\n- [ ] --history includes scrollback\n- [ ] --lines controls scrollback amount\n- [ ] --follow polls continuously\n- [ ] Non-tmux workers read from log files\n- [ ] --follow works with tail -f for non-tmux","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T20:09:30.092257965Z","created_by":"mtomcal","updated_at":"2026-01-10T20:09:30.092257965Z","dependencies":[{"issue_id":"swarm-an5","depends_on_id":"swarm-1j8","type":"blocks","created_at":"2026-01-10T20:11:24.234598136Z","created_by":"mtomcal"},{"issue_id":"swarm-an5","depends_on_id":"swarm-ljn","type":"blocks","created_at":"2026-01-10T20:11:24.268169341Z","created_by":"mtomcal"}]}
{"id":"swarm-dio","title":"Command: status - Get status of specific worker","description":"## Overview\nImplement the `swarm status` command for detailed worker status.\n\n## Dependencies\n- Depends on: swarm-1j8 (state), swarm-ljn (helpers)\n\n## Usage\n```bash\nswarm status \u003cname\u003e\n```\n\n## Output\n```\nw1: running (tmux window swarm:w1, worktree ../swarm-worktrees/w1, uptime 5m)\n```\n\n## Exit Codes\n- 0: running\n- 1: stopped/dead\n- 2: not found\n\n## Acceptance Criteria\n- [ ] Shows tmux info if tmux worker\n- [ ] Shows PID if non-tmux worker\n- [ ] Shows worktree path if applicable\n- [ ] Shows uptime in human-readable format\n- [ ] Correct exit codes","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T20:08:20.562593207Z","created_by":"mtomcal","updated_at":"2026-01-10T20:08:20.562593207Z","dependencies":[{"issue_id":"swarm-dio","depends_on_id":"swarm-1j8","type":"blocks","created_at":"2026-01-10T20:11:23.782471729Z","created_by":"mtomcal"},{"issue_id":"swarm-dio","depends_on_id":"swarm-ljn","type":"blocks","created_at":"2026-01-10T20:11:23.81637748Z","created_by":"mtomcal"}]}
{"id":"swarm-fd8","title":"Command: ls - List all tracked workers","description":"## Overview\nImplement the `swarm ls` command to list all tracked workers.\n\n## Dependencies\n- Depends on: swarm-1j8 (state), swarm-ljn (helpers)\n\n## Usage\n```bash\nswarm ls [options]\n```\n\n## Options\n- `--format \u003cfmt\u003e` — Output format: `table` (default), `json`, `names`\n- `--status \u003cstatus\u003e` — Filter: `running`, `stopped`, `all` (default)\n- `--tag \u003ctag\u003e` — Filter by tag\n\n## Output Examples\n\n**Table (default):**\n```\nNAME    STATUS   PID/WINDOW      STARTED   WORKTREE                  TAG\nw1      running  swarm:w1        5m ago    ../swarm-worktrees/w1     pr-review\nw2      running  swarm:w2        3m ago    ../swarm-worktrees/w2     pr-review\nw3      stopped  -               10m ago   ../swarm-worktrees/w3     impl\n```\n\n**Names:**\n```\nw1\nw2\nw3\n```\n\n**JSON:**\n```json\n[{\"name\": \"w1\", \"status\": \"running\", ...}, ...]\n```\n\n## Behavior\n1. Load state file\n2. Refresh actual status of each worker (check tmux/pid)\n3. Filter by --status and --tag if specified\n4. Format and output\n\n## Acceptance Criteria\n- [ ] Table format with proper alignment\n- [ ] JSON output is valid JSON\n- [ ] Names output is one per line\n- [ ] Status filter works correctly\n- [ ] Tag filter works correctly\n- [ ] Status is refreshed from actual state (not just stored)","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T20:08:13.006011282Z","created_by":"mtomcal","updated_at":"2026-01-10T20:08:13.006011282Z","dependencies":[{"issue_id":"swarm-fd8","depends_on_id":"swarm-1j8","type":"blocks","created_at":"2026-01-10T20:11:23.718416428Z","created_by":"mtomcal"},{"issue_id":"swarm-fd8","depends_on_id":"swarm-ljn","type":"blocks","created_at":"2026-01-10T20:11:23.751601055Z","created_by":"mtomcal"}]}
{"id":"swarm-ljn","title":"Core: Helper functions for git, tmux, and process operations","description":"## Overview\nImplement helper functions needed by all commands.\n\n## Dependencies\n- Depends on: swarm-1j8 (state management)\n\n## Git Operations\n```python\ndef get_git_root() -\u003e Path:\n    \"\"\"Get root of current git repo.\"\"\"\n\ndef create_worktree(path: Path, branch: str) -\u003e None:\n    \"\"\"Create a git worktree.\"\"\"\n\ndef remove_worktree(path: Path) -\u003e None:\n    \"\"\"Remove a git worktree.\"\"\"\n```\n\n## Tmux Operations\n```python\ndef ensure_tmux_session(session: str) -\u003e None:\n    \"\"\"Create tmux session if it doesn't exist.\"\"\"\n\ndef create_tmux_window(session: str, window: str, cwd: Path, cmd: list[str]) -\u003e None:\n    \"\"\"Create a tmux window and run command.\"\"\"\n\ndef tmux_send(session: str, window: str, text: str, enter: bool = True) -\u003e None:\n    \"\"\"Send text to a tmux window.\"\"\"\n\ndef tmux_window_exists(session: str, window: str) -\u003e bool:\n    \"\"\"Check if a tmux window exists.\"\"\"\n\ndef tmux_capture_pane(session: str, window: str, history_lines: int = 0) -\u003e str:\n    \"\"\"Capture contents of a tmux pane.\"\"\"\n```\n\n## Process Operations\n```python\ndef spawn_process(cmd: list[str], cwd: Path, env: dict, log_prefix: Path) -\u003e int:\n    \"\"\"Spawn a background process, return PID.\"\"\"\n\ndef process_alive(pid: int) -\u003e bool:\n    \"\"\"Check if a process is alive.\"\"\"\n```\n\n## Status Refresh\n```python\ndef refresh_worker_status(worker: dict) -\u003e str:\n    \"\"\"Check actual status of a worker (tmux or pid).\"\"\"\n```\n\n## Acceptance Criteria\n- [ ] All helper functions implemented\n- [ ] Use shlex.quote for shell command safety\n- [ ] Use pathlib.Path throughout\n- [ ] Proper error handling with clear messages","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T20:07:39.549827994Z","created_by":"mtomcal","updated_at":"2026-01-10T20:07:39.549827994Z","dependencies":[{"issue_id":"swarm-ljn","depends_on_id":"swarm-1j8","type":"blocks","created_at":"2026-01-10T20:10:42.442237762Z","created_by":"mtomcal"}]}
{"id":"swarm-snt","title":"Command: clean - Clean up dead workers","description":"## Overview\nImplement the `swarm clean` command to clean up dead workers and their worktrees.\n\n## Dependencies\n- Depends on: swarm-1j8 (state), swarm-ljn (helpers)\n\n## Usage\n```bash\nswarm clean \u003cname\u003e [options]\nswarm clean --all [options]\n```\n\n## Options\n- `--rm-worktree` — Remove git worktree (default: true for clean)\n- `--all` — Clean all stopped workers\n\n## Behavior\n1. Verify worker is stopped\n2. If worktree exists: `git worktree remove {path} --force`\n3. Remove from state.json\n4. Remove log files if they exist\n\n## Acceptance Criteria\n- [ ] Only cleans stopped workers\n- [ ] Error if trying to clean running worker\n- [ ] Removes worktree by default\n- [ ] Removes log files\n- [ ] Removes from state.json\n- [ ] --all cleans all stopped workers","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T20:08:47.557489889Z","created_by":"mtomcal","updated_at":"2026-01-10T20:08:47.557489889Z","dependencies":[{"issue_id":"swarm-snt","depends_on_id":"swarm-1j8","type":"blocks","created_at":"2026-01-10T20:11:23.973225208Z","created_by":"mtomcal"},{"issue_id":"swarm-snt","depends_on_id":"swarm-ljn","type":"blocks","created_at":"2026-01-10T20:11:24.004632272Z","created_by":"mtomcal"}]}
{"id":"swarm-szj","title":"Command: spawn - Spawn new worker processes","description":"## Overview\nImplement the `swarm spawn` command to spawn new worker processes.\n\n## Dependencies\n- Depends on: swarm-1j8 (state), swarm-ljn (helpers)\n\n## Usage\n```bash\nswarm spawn --name \u003cname\u003e [options] -- \u003ccommand...\u003e\n```\n\n## Options\n- `--name \u003cname\u003e` — Unique identifier (required)\n- `--tmux` — Run in a tmux window\n- `--session \u003cname\u003e` — Tmux session name (default: \"swarm\")\n- `--worktree` — Create a git worktree\n- `--branch \u003cname\u003e` — Branch name for worktree (default: same as --name)\n- `--worktree-dir \u003cpath\u003e` — Parent dir for worktrees (default: `../swarm-worktrees`)\n- `--tag \u003ctag\u003e` — Tag for filtering (repeatable)\n- `--env KEY=VAL` — Environment variable (repeatable)\n- `--cwd \u003cpath\u003e` — Working directory\n\n## Behavior\n1. Validate name is unique (not already in state)\n2. If `--worktree`:\n   - Detect git repo root from cwd\n   - Compute worktree path: `{worktree-dir}/{name}`\n   - Run: `git worktree add {worktree_path} -b {branch}`\n   - Set working directory to worktree path\n3. If `--tmux`:\n   - Ensure session exists\n   - Create window with `tmux new-window`\n   - Send command with `tmux send-keys`\n4. If not `--tmux`:\n   - Spawn via subprocess.Popen\n   - Capture stdout/stderr to `~/.swarm/logs/{name}.stdout` and `.stderr`\n   - Store PID directly\n5. Record state to `~/.swarm/state.json`\n\n## Example\n```bash\nswarm spawn --name w1 --tmux --worktree --branch work/bd-001 -- claude\n```\n\n## Acceptance Criteria\n- [ ] Non-tmux spawn works with PID tracking\n- [ ] Tmux spawn creates window and runs command\n- [ ] Worktree creation works\n- [ ] State is persisted correctly\n- [ ] Duplicate name rejected with error","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T20:07:54.175495393Z","created_by":"mtomcal","updated_at":"2026-01-10T20:07:54.175495393Z","dependencies":[{"issue_id":"swarm-szj","depends_on_id":"swarm-1j8","type":"blocks","created_at":"2026-01-10T20:10:43.333638061Z","created_by":"mtomcal"},{"issue_id":"swarm-szj","depends_on_id":"swarm-ljn","type":"blocks","created_at":"2026-01-10T20:10:43.965220949Z","created_by":"mtomcal"}]}
{"id":"swarm-vul","title":"Command: send - Send text to tmux workers","description":"## Overview\nImplement the `swarm send` command to send text to tmux-based workers.\n\n## Dependencies\n- Depends on: swarm-1j8 (state), swarm-ljn (helpers)\n\n## Usage\n```bash\nswarm send \u003cname\u003e \u003ctext\u003e\nswarm send --all \u003ctext\u003e\n```\n\n## Options\n- `--no-enter` — Don't append Enter key after text\n- `--all` — Send to all running tmux workers\n\n## Behavior\n```bash\ntmux send-keys -t {session}:{name} \"{text}\" Enter\n```\n\n## Examples\n```bash\nswarm send w1 \"implement the auth flow\"\nswarm send w1 \"/review\"\nswarm send w1 \"/pr --title 'feat: auth'\"\nswarm send --all \"check your amail inbox\"\n```\n\n## Errors\n- If worker is not tmux-based, exit with error\n- If worker is not running, exit with error\n\n## Acceptance Criteria\n- [ ] Sends text to tmux window\n- [ ] --no-enter skips Enter key\n- [ ] --all sends to all running tmux workers\n- [ ] Error for non-tmux workers\n- [ ] Error for non-running workers","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T20:09:03.277740362Z","created_by":"mtomcal","updated_at":"2026-01-10T20:09:03.277740362Z","dependencies":[{"issue_id":"swarm-vul","depends_on_id":"swarm-1j8","type":"blocks","created_at":"2026-01-10T20:11:24.037412162Z","created_by":"mtomcal"},{"issue_id":"swarm-vul","depends_on_id":"swarm-ljn","type":"blocks","created_at":"2026-01-10T20:11:24.070741083Z","created_by":"mtomcal"}]}
{"id":"swarm-x8r","title":"Command: wait - Wait for workers to finish","description":"## Overview\nImplement the `swarm wait` command to wait for workers to finish.\n\n## Dependencies\n- Depends on: swarm-1j8 (state), swarm-ljn (helpers)\n\n## Usage\n```bash\nswarm wait \u003cname\u003e\nswarm wait --all [options]\n```\n\n## Options\n- `--timeout \u003cseconds\u003e` — Max wait time (default: infinite)\n- `--all` — Wait for all workers\n\n## Behavior (tmux)\n- Poll `tmux list-windows -t {session}` until window disappears\n- Return exit code 0 when done\n\n## Behavior (non-tmux)\n- Use waitpid() or poll /proc/{pid}\n\n## Output\n```\nw1: exited\nw2: exited\nw3: still running (timeout)\n```\n\n## Acceptance Criteria\n- [ ] Blocks until tmux window closes\n- [ ] Blocks until process exits (non-tmux)\n- [ ] Timeout works correctly\n- [ ] --all waits for all workers\n- [ ] Clear output showing which exited","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T20:08:40.45801292Z","created_by":"mtomcal","updated_at":"2026-01-10T20:08:40.45801292Z","dependencies":[{"issue_id":"swarm-x8r","depends_on_id":"swarm-1j8","type":"blocks","created_at":"2026-01-10T20:11:23.908686247Z","created_by":"mtomcal"},{"issue_id":"swarm-x8r","depends_on_id":"swarm-ljn","type":"blocks","created_at":"2026-01-10T20:11:23.941328407Z","created_by":"mtomcal"}]}
