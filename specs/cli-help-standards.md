# CLI Help Standards

## Overview

This spec defines the standard format for CLI help text across all swarm commands. Help text is the primary documentation for AI agents using swarm, so it must be comprehensive, example-rich, and self-contained. An agent should be able to use any swarm command correctly by reading only its `-h` output.

## Dependencies

- External: argparse (Python)
- Internal: All command specs

## Principles

### 1. Help as Primary Documentation

AI agents learn commands from `-h` output. Help text must be:
- **Self-contained**: No need to read external docs
- **Example-driven**: Show, don't just tell
- **Comprehensive**: Cover all flags, common patterns, edge cases

### 2. Consistent Structure

Every command's help follows the same structure:
1. Usage line (auto-generated by argparse)
2. Description paragraph
3. Arguments/options (auto-generated by argparse)
4. Extended sections (epilog):
   - Examples
   - Related commands
   - Warnings (for destructive commands)

### 3. Agent-Friendly Language

- Use imperative verbs: "Create", "Stop", "List"
- Be explicit about defaults
- Explain "why" not just "what"
- Include error recovery hints

## Help Text Template

### Short Commands (ls, status, attach)

```
usage: swarm <cmd> [options]

<One-line description of what this command does.>

<positional arguments if any>

options:
  -h, --help     show this help message and exit
  <other flags>

Examples:
  <cmd> <basic example>           # <what it does>
  <cmd> <common variation>        # <what it does>
  <cmd> <advanced example>        # <what it does>

See Also:
  swarm <related1> --help
  swarm <related2> --help
```

### Medium Commands (spawn, kill, send)

```
usage: swarm <cmd> [options] <args>

<One paragraph description explaining:
 - What this command does
 - When to use it
 - Key concepts>

<positional arguments>

options:
  -h, --help            show this help message and exit
  <flags with detailed help text for each>

Examples:
  # <Category 1>
  <cmd> <example>
  <cmd> <example>

  # <Category 2>
  <cmd> <example>

Common Patterns:
  <Pattern description>:
    <command sequence>

Warnings:  # If destructive
  <What can go wrong and how to avoid it>

See Also:
  swarm <related> --help
```

### Complex Commands (ralph, heartbeat)

```
usage: swarm <cmd> {subcommand,...} [options]

<Overview paragraph explaining the feature's purpose>

<Conceptual explanation of how it works - 2-3 sentences>

positional arguments:
  {sub1,sub2,...}
    sub1        <description>
    sub2        <description>

options:
  -h, --help    show this help message and exit

Quick Start:
  1. <First step>
  2. <Second step>
  3. <Third step>

Quick Reference:
  swarm <cmd> <common1>    # <what it does>
  swarm <cmd> <common2>    # <what it does>
  swarm <cmd> <common3>    # <what it does>

<Additional Sections as needed - e.g., "Prompt Design Principles">

See Also:
  swarm <cmd> <sub> --help   # Detailed help for subcommand
```

### Subcommand Help (ralph spawn, heartbeat start)

```
usage: swarm <cmd> <sub> [options] <args>

<Detailed description of this specific subcommand>

<positional arguments>

options:
  -h, --help            show this help message and exit
  <all flags with extensive help text>

<Format/Schema Documentation if applicable>:
  <Field>: <description>
  <Field>: <description>
  ...

Examples:
  # <Scenario 1>
  swarm <cmd> <sub> <full example with all relevant flags>

  # <Scenario 2>
  swarm <cmd> <sub> <different example>

  # <Scenario 3 - Error recovery>
  swarm <cmd> <sub> <example showing recovery>

<Reference sections as needed>:
  <Detailed documentation of formats, patterns, etc.>

Tips:
  - <Tip 1>
  - <Tip 2>

Debugging:
  <How to troubleshoot common issues>
```

## Required Sections by Command

| Command | Description | Examples | Format Docs | Warnings | Tips |
|---------|-------------|----------|-------------|----------|------|
| spawn | Yes | 3+ | - | - | Yes |
| ls | Yes | 2+ | - | - | - |
| status | Yes | 2+ | - | - | - |
| send | Yes | 3+ | - | - | Yes |
| interrupt | Yes | 2+ | - | - | - |
| eof | Yes | 2+ | - | - | - |
| attach | Yes | 2+ | - | - | Yes |
| logs | Yes | 3+ | - | - | - |
| kill | Yes | 3+ | - | **Yes** | Yes |
| wait | Yes | 2+ | - | - | - |
| clean | Yes | 2+ | - | **Yes** | - |
| respawn | Yes | 2+ | - | - | - |
| init | Yes | 2+ | - | - | - |
| ralph | Yes | Quick Ref | - | - | Principles |
| ralph spawn | Yes | 4+ | - | - | Yes |
| ralph status | Yes | 2+ | - | - | - |
| ralph pause | Yes | 2+ | - | - | - |
| ralph resume | Yes | 2+ | - | - | - |
| ralph run | Yes | 2+ | - | - | - |
| ralph list | Yes | 2+ | - | - | - |
| ralph init | Yes | 2+ | Template | - | - |
| heartbeat | Yes | Quick Ref | - | - | - |
| heartbeat start | Yes | 3+ | Duration | - | Yes |
| heartbeat stop | Yes | 2+ | - | - | - |
| heartbeat list | Yes | 1+ | - | - | - |
| heartbeat status | Yes | 2+ | - | - | - |

## Flag Help Text Standards

### Format

```python
parser.add_argument(
    '--flag-name',
    help='What this flag does. Default: <value>. '
         'Additional context or constraints.'
)
```

### Requirements

1. **First sentence**: What the flag does (imperative)
2. **Default value**: Always state explicitly
3. **Constraints**: Valid values, ranges, formats
4. **Context**: When/why to use this flag

### Examples

**Good**:
```python
'--timeout', help='Maximum time to wait in seconds. Default: 120. '
                  'Use 0 for no timeout.'
```

**Bad**:
```python
'--timeout', help='timeout value'
```

**Good**:
```python
'--worktree', help='Create isolated git worktree for this worker. '
                   'Worktree created at <repo>-worktrees/<name>/. '
                   'Branch name matches worker name unless --branch specified.'
```

**Bad**:
```python
'--worktree', help='use worktree'
```

## Example Quality Standards

### Requirements

1. **Realistic**: Use plausible names, paths, values
2. **Complete**: Show full command with all relevant flags
3. **Commented**: Brief inline comment explaining what it does
4. **Progressive**: Start simple, build to complex

### Good Example Block

```
Examples:
  # Basic usage
  swarm spawn --name worker1 --tmux -- claude

  # With git worktree isolation
  swarm spawn --name feature-auth --tmux --worktree -- claude

  # With environment variables and tags
  swarm spawn --name api-dev --tmux --worktree \
    --env API_KEY=test --tag backend --tag priority -- claude

  # Wait for agent to be ready before returning
  swarm spawn --name worker1 --tmux --ready-wait -- claude
```

### Bad Example Block

```
Examples:
  swarm spawn --name x --tmux -- cmd
  swarm spawn -n y -t -w -- cmd
```

## Inline Documentation for Complex Formats

Commands that accept complex inputs (YAML, patterns, durations) must document the format inline in help text.

### Duration Format

```
Duration Format:
  Accepts: "4h", "30m", "90s", "1h30m", or seconds as integer
  Examples: "4h" = 4 hours, "30m" = 30 minutes, "1h30m" = 90 minutes
```

### Pattern Format

```
Pattern Format:
  Regular expression matched against worker output.
  Examples:
    "/done"              - Literal string
    "COMPLETE|FINISHED"  - Alternatives
    "Task \d+ done"      - With regex
```

## Implementation Checklist

When adding or updating a command:

- [ ] Description explains what AND why
- [ ] All flags have detailed help text with defaults
- [ ] Examples section with 2+ realistic examples
- [ ] Complex formats documented inline
- [ ] Related commands referenced
- [ ] Warnings for destructive operations
- [ ] Tips for common patterns

## Scenarios

### Scenario: Agent reads help to learn spawn
- **Given**: An AI agent needs to spawn a worker
- **When**: Agent runs `swarm spawn --help`
- **Then**:
  - Agent understands all flags and their purposes
  - Agent can construct correct command from examples
  - Agent knows about worktree isolation option
  - Agent knows about ready-wait option

### Scenario: Agent troubleshoots failed command
- **Given**: An AI agent's command failed
- **When**: Agent re-reads help for that command
- **Then**:
  - Agent finds debugging tips
  - Agent finds related commands for investigation
  - Agent finds warnings about common mistakes
